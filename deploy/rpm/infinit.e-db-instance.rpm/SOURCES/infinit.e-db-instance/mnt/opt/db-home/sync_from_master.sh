#!/bin/sh
###########################################################################
# sync_from_master.sh
###########################################################################
# Get MongoDB Master DB Address
###########################################################################
MONGO_MASTER=`grep "^db.server=" /mnt/opt/infinite-home/config/infinite.service.properties | sed s/'db.server='// | sed s/' '//g`

###########################################################################
# Download backup from the master server to /opt/db-home
###########################################################################
cd /opt/db-home
scp -i pk-production.pem root@$MONGO_MASTER:/mnt-backup/db.tgz .

###########################################################################
# 
###########################################################################
rm -rf ./mnt-backup
tar xzvf db.tgz

###########################################################################
# Run the MongoDB restore script
###########################################################################
./restore-script.sh
